<html>
<body>
<input type="file" id="log_file">
<script src="lf_scripts/lovefield.js"></script>
<script src="LovefieldService.js"></script>
<script src="logcruncher.js"></script>
<script>
function handleLog(evt) {
  var file = evt.target.files[0];
  var reader = new FileReader();
  reader.onload = function(progressEvent) {
    var JSONArray = logCruncher(this.result, testsFilter);
    console.log(JSONArray);
    var lovefield = new LovefieldService();
    lovefield.getDbConnection().then( function(db) {
      lovefield.insertData(JSONArray).then(function() {
        console.log("Data successfully added!");
      });
    });
  };
  reader.readAsText(file, "UTF-8");
}
document.getElementById("log_file").addEventListener("change", handleLog, false);
</script>
</body>
</html>